┌──────────────────────────────────────────────────────────────┐
│                       QUANTIX v3.1                            │
│               EVENT-BASED SIGNAL LIFECYCLE                    │
└──────────────────────────────────────────────────────────────┘


┌──────────────────────────────┐
│           ANALYZER             │
│         (STEP 1 & 2)           │
└──────────────────────────────┘
            │
            │ Historical Data
            ▼
┌──────────────────────────────┐
│      StructureEngine         │
│  - Detect opportunity        │
│  - Confidence ≥ Threshold    │
└──────────────────────────────┘
            │
            ▼
┌──────────────────────────────┐
│ SEND SIGNAL                  │
│ status = WAITING             │
│ created_at = server_time     │
└──────────────────────────────┘
            │
            ▼
┌──────────────────────────────┐
│ DATABASE (IMMUTABLE)         │
└──────────────────────────────┘
 Analyzer kết thúc – không canh giá


┌──────────────────────────────┐
│            WATCHER            │
│        (LIVE OBSERVER)        │
└──────────────────────────────┘
            │
            │ Loop mỗi SCAN_INTERVAL
            ▼
┌────────────────────────────────────────────┐
│ FOR EACH WAITING SIGNAL:                   │
│                                            │
│  PRICE HIT ENTRY ?                         │
│    ├─ YES                                 │
│    │   → SEND SIGNAL: ENTRY_HIT           │
│    │   → status = ENTRY_HIT               │
│    │   → entry_hit_at = now               │
│    │                                      │
│    └─ NO                                  │
│                                            │
│  WAIT TIME > 35 MINUTES ?                 │
│    ├─ YES                                 │
│    │   → SEND SIGNAL: EXPIRED             │
│    │   → status = EXPIRED                 │
│    │   → closed_at = now                  │
│    │   → CLOSE LIFECYCLE                  │
│    │                                      │
│    └─ NO → tiếp tục chờ                   │
└────────────────────────────────────────────┘


┌──────────────────────────────┐
│        TRADE WATCHER          │
│      (SAU ENTRY_HIT)          │
└──────────────────────────────┘
            │
            ▼
┌────────────────────────────────────────────┐
│ FOR EACH ENTRY_HIT SIGNAL:                 │
│                                            │
│  PRICE HIT TP ?                            │
│    ├─ YES                                 │
│    │   → SEND SIGNAL: TP_HIT              │
│    │   → status = TP_HIT                  │
│    │   → CLOSE TRADE                      │
│                                            │
│  PRICE HIT SL ?                            │
│    ├─ YES                                 │
│    │   → SEND SIGNAL: SL_HIT              │
│    │   → status = SL_HIT                  │
│    │   → CLOSE TRADE                      │
└────────────────────────────────────────────┘


┌──────────────────────────────┐
│        TERMINAL STATES        │
│  EXPIRED (no entry)          │
│  TP_HIT / SL_HIT (after entry)│
└──────────────────────────────┘
